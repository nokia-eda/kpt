apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: transactionresults.core.eda.nokia.com
spec:
  group: core.eda.nokia.com
  names:
    kind: TransactionResult
    listKind: TransactionResultList
    plural: transactionresults
    singular: transactionresult
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.result
      name: Result
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    - jsonPath: .spec.dryRun
      name: DryRun
      type: string
    - jsonPath: .spec.description
      name: Description
      type: string
    name: v1
    schema:
      openAPIV3Schema:
        description: TransactionResult is the Schema for the transactionresults API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: TransactionResultSpec defines the desired state of TransactionResult
            properties:
              applicationErrors:
                description: Any errors generated by applications run in this transaction.
                items:
                  properties:
                    errors:
                      description: Errors returned by this application, if any.
                      items:
                        type: string
                      type: array
                    gvk:
                      description: Group, version, kind of the application.
                      type: string
                    name:
                      description: Name of the application.
                      type: string
                    namespace:
                      description: Namespace of the application.
                      type: string
                    script:
                      description: Application execution information.
                      properties:
                        executionTimeUs:
                          description: Execution time in microseconds.
                          type: integer
                        output:
                          description: Any output from the application.
                          type: string
                      type: object
                  required:
                  - gvk
                  - name
                  - namespace
                  - script
                  type: object
                type: array
              bundledTransactionId:
                description: The transaction Id of the transaction that this transaction is bundled with, if any.
                type: integer
              commit:
                description: The git commit hash of the transaction
                type: string
              description:
                description: The description passed through from the input transaction, if any.
                type: string
              dryRun:
                description: Indicates if the transaction was a dry run.
                type: boolean
              executionSummary:
                description: A summary of this transaction
                properties:
                  appSummary:
                    description: Summary of applications run in this transaction.
                    items:
                      properties:
                        gvk:
                          description: Group, version, kind of the application.
                          type: string
                        instancesRun:
                          description: The number of resources of this kind that were processed.
                          type: integer
                        totalExecutionTimeMs:
                          description: Total execution time in milliseconds.
                          type: integer
                      required:
                      - gvk
                      - instancesRun
                      - totalExecutionTimeMs
                      type: object
                    type: array
                  engineTimeMs:
                    description: The time spent in the engine computing the transaction in milliseconds.
                    type: integer
                  inputResourceCount:
                    description: The number of input resources processed in this transaction.
                    type: integer
                  publishTimeMs:
                    description: The time spent publishing changes to Kubernetes.
                    type: integer
                  pushTimeMs:
                    description: The time spent pushing changes to targets.
                    type: integer
                  saveTimeMs:
                    description: The time spent saving changes to git.
                    type: integer
                  targetsModified:
                    description: Targets with configuration changes in this transaction.
                    items:
                      properties:
                        name:
                          description: The name of a target that generated an error.
                          type: string
                        namespace:
                          description: Namespace of the application.
                          type: string
                      required:
                      - name
                      - namespace
                      type: object
                    type: array
                  targetsModifiedCount:
                    description: The number of targets with configuration changes in this transaction.
                    type: integer
                  totalTimeMs:
                    description: The total time spent executing the transaction. Due to parallelism, this may be less than the sum of the other times.
                    type: integer
                type: object
              generalErrors:
                description: Any errors that aren't specific or can't be mapped to an individual application.
                items:
                  type: string
                type: array
              inputResources:
                description: The set of input resources that were processed in the transaction.
                items:
                  properties:
                    action:
                      description: Action on the resource.
                      type: string
                    gvk:
                      description: Group, version, kind of the resource.
                      type: string
                    name:
                      description: Name of the resource.
                      type: string
                    namespace:
                      description: Namespace of the resource.
                      type: string
                  required:
                  - gvk
                  - name
                  - namespace
                  type: object
                type: array
              result:
                description: The transaction result.
                type: string
              targetErrors:
                description: Any errors generated by targets in this transaction.
                items:
                  properties:
                    errors:
                      description: Errors returned by this target.
                      items:
                        type: string
                      type: array
                    name:
                      description: The name of a target that generated an error.
                      type: string
                    namespace:
                      description: Namespace of the application.
                      type: string
                  required:
                  - name
                  - namespace
                  type: object
                type: array
              timestamp:
                description: The timestamp when the transaction finished
                format: date-time
                type: string
              username:
                description: The username of the user that initiated the transaction
                type: string
            type: object
          status:
            description: TransactionResultStatus defines the observed state of TransactionResult
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
